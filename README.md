# TestWork67 — Storefront Child Theme

**Дочерняя тема для Storefront**, предоставляющая:

* **Custom Post Type** `Cities` (города)
* **Meta Boxes** для полей `latitude` и `longitude`
* **Custom Taxonomy** `Countries` для группировки городов по странам
* **Виджет "Погода города"** с выбором города и показом текущей температуры из Open-Meteo
* **Страницу с таблицей** стран, городов и температурой + AJAX-поиск

---

## Требования

* WordPress **5.7+**
* PHP **7.4+**
* Тема **Storefront** (версия 3.x)

---

## Установка

1. **Клонируйте репозиторий** куда-нибудь локально:

   ```bash
   git clone https://github.com/Gelendwvwvwvein/TestWork67.git
   ```
2. **Скопируйте папку темы** в директорию тем WordPress:

   ```bash
   cp -r TestWork67/storefront-child C:/wamp64/www/TestWork67/wp-content/themes/
   ```
3. **Активируйте тему**:

   * В админ-панели WP: **Внешний вид → Темы → Storefront Child → Активировать**.
4. **Настройте подключение к базе**:

   * При необходимости скопируйте `wp-config-sample.php` → `wp-config.php` и укажите параметры базы данных.
5. **Импорт содержимого (опционально)**:

   * Если приложен дамп БД (`db/dump.sql`), импортируйте:

     ```bash
     mysql -u USER -p DATABASE_NAME < db/dump.sql
     ```
6. **Обновите постоянные ссылки**:

   * В админ-панели WP: **Настройки → Постоянные ссылки → Сохранить изменения** (без правок).

---

## Использование

### 1. Таксономия Countries

* В админ-панели перейдите **Countries → Добавить новый**.
* Создайте необходимые термины (например: `Россия`, `USA` и т.д.).

### 2. CPT Cities

* В админ-панели перейдите **Cities → Добавить новый**.
* Укажите заголовок записи и заполните метаполя `latitude` и `longitude`.
* В правой боковой панели выберите нужный термин **Country** для данной записи.

### 3. Виджет «Погода города»

* Перейдите **Внешний вид → Виджеты**.
* Найдите виджет **Погода города**.
* Добавьте его в область виджетов, задайте заголовок и выберите город.

### 4. Страница «Погода в городах»

* Создайте новую страницу (**Страницы → Добавить новую**).
* В атрибутах страницы выберите шаблон **Погода в городах**.
* Опубликуйте страницу и перейдите по её URL, чтобы увидеть таблицу стран, городов и текущей температуры.
* **AJAX-поиск**: введите название города в поле над таблицей — результаты обновятся без перезагрузки.

### 5. Action Hooks

В шаблоне `page-cities-weather.php` используются два хука:

```php
// Перед таблицей
do_action('sc_before_cities_table');

// После таблицы
do_action('sc_after_cities_table');
```

Они позволяют добавить дополнительный контент до или после таблицы без правки самого шаблона.

---

## Структура репозитория

```
TestWork67/
├─ README.md
├─ .gitignore
└─ storefront-child/
   ├─ style.css
   ├─ functions.php
   ├─ templates/
   │  └─ page-cities-weather.php
   ├─ assets/
   │  └─ js/cities-search.js
   └─ inc/
      ├─ cpt-cities.php
      ├─ meta-boxes.php
      ├─ taxonomies.php
      └─ widgets/widget-city-weather.php
```

---

## Дополнительно

* **Кэширование погоды**: температура каждого города кэшируется на **1 час** в transient.
* **Безопасность**: все AJAX-запросы защищены `nonce`, запросы к базе выполнены через `$wpdb->prepare()`.
* **Gutenberg**: все метабоксы и таксономии работают и в классическом редакторе, и в Gutenberg.
